<!DOCTYPE html>
<html>
<head>
	<title>Bus Structure</title>

	<meta name="viewport" content="width=device-width,initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">

	<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">

    <script src="static/js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="container">
		<h2 class="text-center">New Journey</h2>
		
		<hr class="w-25">
		
		<div class="row">
			<div class="col-md-6">
				<h5>Departure & Destination</h5>
				<div class="form-row border m-0 bg-light">
					<div class="form-group text-center col-md-6">
						<small>From</small>
						<input id="from" class="shadow-sm form-control text-center" type="text" name="from">
					</div>	
					<div class="form-group text-center col-md-6">
						<small>To</small>
						<input id="to" class="shadow-sm form-control text-center" type="text" name="">
					</div>
				</div>
				<hr>
				<h5>Pickup Points</h5>
				<div class="card btn-block">
					<div class="card-header p-2 text-center">
						<input id="pickup-point-input" type="text" class="form-control text-center shadow-sm btn-text-center">
					</div>
					<ul id="pickup-point-list" class="list-group list-group-flush">
					</ul>
				</div>
				<hr>
			</div>

			<div class="col-md-6">
				<h5>Pricing</h5>
				<div class="border">
					<ul class="nav nav-tabs bg-light pt-2 px-2" id="myTab" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">ORDINARY</a>
						</li>
					</ul>

					<div class="tab-content" id="myTabContent">
						<div class="tab-pane p-2 fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

							<div class="form-row">
								<div class="form-group text-center col-md-5">
									<small>Stop Point</small>
									<input id="stop-point" class="shadow-sm form-control text-center" type="text" name="">
								</div>	
								<div class="form-group text-center col-md-5">
									<small>Price</small>
									<input id="price" class="shadow-sm form-control text-center" type="number" name="">
								</div>
								<div class="form-group col-md-2">
									<small class="text-light">_______</small>
									<button id="add-pricing" class="btn btn-primary btn-block">Add</button>
								</div>
							</div>
						</div>

						<div class="p-2">
							<small>Pricing List</small>
							<ul id="pricing-list" class="list-group">
								<li class="list-group-item">karuma<span class="float-right"><label>20000</label> <button class="fa fa-pencil p-1"></button><button class="fa fa-times p-1"></button></span></li>
							</ul>	
						</div>
					</div>
				</div>
			</div>
		</div>

		<hr class="w-25">
		
		<div class="row">
			<div class="col" align="center">
				<button class="btn btn-primary"><span class="fa fa-save"></span> Save</button>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		let data = {
			from: '',
			to: '',
			pickups: ["STATION"],
			pricing: [
			]
		}
		

		function loadPickups(){
			$('#pickup-point-list').html('')
			for (var i=0; i < data.pickups.length; i++) {
				$('#pickup-point-list').append(
					`<li class="list-group-item text-center">${data.pickups[i]}<button class="btn btn-danger float-right badge badge-danger" onclick="removeBusType('${data.pickups[i]}')">&times;</button></li>`
		    	)
			}
		}

		function removeBusType(type){
			data.pickups = data.pickups.filter((each)=>{
				return each !== type
			});
			loadPickups()
		}


		$('#pickup-point-input').on('keypress', (event)=>{
			if (event.keyCode === 13) {
				event.preventDefault();
				type = event.target.value.toUpperCase()
				if (!(data.pickups.includes(type))){
					data.pickups.push(type)
					event.target.value = ''
					loadPickups()
				}else{

				}
			}
		})


		// changes the from value 
		$("#from").on("keyup", (event)=>{
			// set data.from value
			data.from = event.target.value
		})

		// changes the to value
		$("#to").on("keyup", (event)=>{
			// set data.to value
			data.to = event.target.value
			
			// set stop point value
			$("#stop-point").val(data.to)
		})


		// add pricing
		$("#add-pricing").on('click', (event)=>{
			// get stop and price values
			stop = $("#stop-point").val()
			price = parseInt($("#price").val())


			// if stop and price values are valid
			if (stop.length && price){
				// add pricing info
				data.pricing.push({stop:stop, price:price})
				
				// load pricings
				loadPricings();

				// clear stop value
				$("#stop-point").val('')

			}
		})


		// remove pricing from data.pricing
		removePricing = function(target){
			data.pricing = data.pricing.filter((pricing, index)=>{
				console.log(index, parseInt(target.dataset.index))
				return index != parseInt(target.dataset.index)
			})

			// load remaining pricings
			loadPricings()
		}


		// loads pricings
		loadPricings = function(){
			$("#pricing-list").html('')
			for (var i=0; i<data.pricing.length; i++) {
				$("#pricing-list").append(`<li class="list-group-item">${data.pricing[i].stop}<span class="float-right"><label>${data.pricing[i].price}</label> <button class="fa fa-pencil p-1"></button><button data-index="${i}" class="remove-pricing fa fa-times p-1" onclick="removePricing(this)"></button></span></li>`)
			}
		}

		loadPickups()
	</script>
</body>

</html>