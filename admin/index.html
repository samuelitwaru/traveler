<!DOCTYPE html>
<html>
<head>
	<title>Admin</title>

	<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/cropper.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/style.css">
	
	<script type="text/javascript" src="static/js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="static/js/popper.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="static/js/script.js"></script>
	<!-- <script type="text/javascript" src="static/js/cropper.min.js"></script> -->
	<script type="text/javascript" src="static/js/cropper.js"></script>

</head>

<body>
	<!-- register company -->
	<div class="container">
			<form id="registerCompanyForm" onsubmit="submit()">
				<h1>New Company</h1>
				<div class="row">
					<div class="col-md-6">
						<div class="form-row p-2 d-block">
							<input id="company" placeholder="Company" class="shadow-sm form-control" type="text" name="company" />
						</div>

						<div class="form-row p-2">
							<div class="custom-file form-group">
								<input id="hidden-img-input" type="hidden" name="logo" >
								<input id="file-input" type="file" class="custom-file-input" onchange="renderImage(this)" accept="image/*" title="Choose Logo" id="customFile" required>
								<label id="file-input-label" class="custom-file-label shadow-sm" for="customFile">Company Logo</label>
							</div>
						</div>

						<div class="form-row p-2">
							<div class="card btn-block">
								<div class="card-header p-2 text-center">
									Bus Types
									<input id="bus-status-input" type="text" class="form-control text-center shadow-sm btn-text-center">
								</div>
								<ul id="status-list" class="list-group list-group-flush">
								</ul>
							</div>
						</div>

						<div class="form-row p-2">
							<button class="btn btn-block btn-success">Submit</button>
						</div>
					</div>

					<div class="col-md-6 border">
						<div class="form-group" align="center">
							<div id="image-loader" class="spinner-border text-primary collapse" role="status">
								<span class="sr-only">Loading...</span>
							</div>
							<div>
								<img id="image" style="display: block; max-width: 100%" src=""/>
							</div>
						</div>

						<div class="collapse">
							<input id="H" type="hidden" /><br>
							<input id="W" type="hidden" /><br>
							<input id="h" type="hidden" /><br>
							<input id="w" type="hidden" /><br>
							<input id="x" type="hidden" /><br>
							<input id="y" type="hidden" /><br>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<script type="text/javascript">
		var imageId = 'image';
		var cropper;
		
		var H = document.getElementById('H');
		var W = document.getElementById('W');
		var h = document.getElementById('h');
		var w = document.getElementById('w');
		var x = document.getElementById('x');
		var y = document.getElementById('y');

		var busTypes = ["ORDINARY"]

		function populateCropValues(H,W,h,w,x,y){
			var image = document.getElementById(imageId);
			H.value = image.naturalHeight
			W.value = image.naturalWidth
			h.value = event.detail.height
			w.value = event.detail.width
			x.value = event.detail.x
			y.value = event.detail.y
		}

		function crop(){
			var image = document.getElementById(imageId);
			cropper = new Cropper(image,  {
				aspectRatio: 1,
				crop(event) {
					populateCropValues(H,W,h,w,x,y)
				}
			})
		}

		function removeCrop(){
			// make new image with new id
			newImgId = Math.random().toString(36).substr(2);
			newImg = $(`<img id="${newImgId}" style="display: block; max-width: 100%">`);
			
			// replace current image with new 
			$(`#${imageId}`).replaceWith(newImg);
			imageId = newImgId

			// remove cropper
			$('.cropper-container').remove()
		}


		function renderImage(tag){
			removeCrop()

			var file = tag.files[0]
			console.dir($('#file-input-label').html(file.name))
			var image = document.getElementById(imageId);
			var reader = new FileReader();
			reader.readAsDataURL(file);
			$('#image-loader').removeClass('collapse');
			reader.onload = function(e) {
    			image.src = this.result;
    			$('#image-loader').addClass('collapse')
    			crop()
			}
		}

		$('#bus-status-input').on('keypress', (event)=>{
			if (event.keyCode === 13) {
				event.preventDefault();
				type = event.target.value.toUpperCase()
				if (!(busTypes.includes(type))){
					busTypes.push(type)
					event.target.value = ''
					loadBusTypes()
				}else{

				}
			}
		})

		function loadBusTypes(){
			$('#status-list').html('')
			for (var i=0; i < busTypes.length; i++) {
				$('#status-list').append(
					`<li class="list-group-item text-center">${busTypes[i]}<button class="btn btn-danger float-right badge badge-danger" onclick="removeBusType('${busTypes[i]}')">&times;</button></li>`
		    	)
			}
		}

		function removeBusType(type){
			busTypes = busTypes.filter((each)=>{
				return each !== type
			});
			loadBusTypes()
		}
			
		loadBusTypes()	
		// crop()

	</script>


</body>
</html>