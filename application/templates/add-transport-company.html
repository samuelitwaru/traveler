{% extends 'head.html' %}

{% block content %}
	<!-- register company -->
	<div class="container">
		<form id="registerCompanyForm" method="POST" enctype="multipart/form-data" action="{{ url_for('company_bp.add_company') }}">
			<h1>New Company</h1>
			<div class="row">
				<div class="col-md-7">
					<div class="form-row p-2 d-block">
						<input id="company" placeholder="Company" class="shadow-sm form-control" type="text" name="company" value="Gagga" required/>
					</div>

					<div class="form-row p-2">
						<div class="custom-file form-group">
							<!-- <input id="hidden-img-input" type="hidden" name="logo" > -->
							<input id="file-input" type="file" name="logo" class="custom-file-input" onchange="renderImage(this)" accept="image/*" title="Choose Logo" id="customFile" required>
							<label id="file-input-label" class="custom-file-label shadow-sm text-nowrap" for="customFile">Company Logo</label>
						</div>
					</div>

					<div class="form-row p-2">
						<button class="btn btn-block btn-success">Submit</button>
					</div>
				</div>

				<div class="col-md-5 border">
					<div class="form-group" align="center">
						<div id="image-loader" class="spinner-border text-primary collapse" role="status">
							<span class="sr-only">Loading...</span>
						</div>
						<div>
							<img id="image" style="display: block; max-width: 100%" src=""/>
						</div>
					</div>

					<div class="collapse">
						<input id="H" name="H" type="hidden" /><br>
						<input id="W" name="W" type="hidden" /><br>
						<input id="h" name="h" type="hidden" /><br>
						<input id="w" name="w" type="hidden" /><br>
						<input id="x" name="x" type="hidden" /><br>
						<input id="y" name="y" type="hidden" /><br>
					</div>
				</div>
			</div>
		</form>
	</div>

	</div>

	<script type="text/javascript">
		// form data
		let company;
		let logo;
		// var busTypes = ["ORDINARY"];

		var imageId = 'image';
		var cropper;
		
		var H = document.getElementById('H');
		var W = document.getElementById('W');
		var h = document.getElementById('h');
		var w = document.getElementById('w');
		var x = document.getElementById('x');
		var y = document.getElementById('y');

		function populateCropValues(H,W,h,w,x,y){
			var image = document.getElementById(imageId);
			H.value = image.naturalHeight
			W.value = image.naturalWidth
			h.value = event.detail.height
			w.value = event.detail.width
			x.value = event.detail.x
			y.value = event.detail.y
		}

		function crop(){
			var image = document.getElementById(imageId);
			cropper = new Cropper(image,  {
				aspectRatio: 1,
				crop(event) {
					populateCropValues(H,W,h,w,x,y)
				}
			})
		}

		function removeCrop(){
			// make new image with new id
			newImgId = Math.random().toString(36).substr(2);
			newImg = $(`<img id="${newImgId}" style="display: block; max-width: 100%">`);
			
			// replace current image with new 
			$(`#${imageId}`).replaceWith(newImg);
			imageId = newImgId

			// remove cropper
			$('.cropper-container').remove()
		}


		function renderImage(tag){
			removeCrop()

			var file = tag.files[0]
			console.dir($('#file-input-label').html(file.name))
			var image = document.getElementById(imageId);
			var reader = new FileReader();
			reader.readAsDataURL(file);
			$('#image-loader').removeClass('collapse');
			reader.onload = function(e) {
    			image.src = this.result;
    			$('#image-loader').addClass('collapse')
    			crop()
			}
		}
	</script>
{% endblock %}